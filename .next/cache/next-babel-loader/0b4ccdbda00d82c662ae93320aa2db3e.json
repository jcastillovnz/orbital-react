{"ast":null,"code":"var _jsxFileName = \"/home/jcastillo-vnz/orbital-react/pages/components/View360/index.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport PreloadImages from './Preload'; // You can play with this to adjust the sensitivity\n// higher values make mouse less sensitive\n\nconst pixelsPerDegree = 2;\n\nconst App = props => {\n  const {\n    dir,\n    numImages\n  } = props;\n  const {\n    0: images,\n    1: setImages\n  } = useState(Array);\n  const {\n    0: imageIndex,\n    1: setImageIndex\n  } = useState(0);\n  const {\n    0: imagesPreloaded,\n    1: setImagesPreloaded\n  } = useState(false);\n  const {\n    0: dragging,\n    1: setDragging\n  } = useState(false);\n  const {\n    0: dragStartIndex,\n    1: setDragStartIndex\n  } = useState(0);\n  const {\n    0: dragStart,\n    1: setDragStart\n  } = useState(0);\n\n  const handleMouseMove = e => {\n    if (dragging === false) {\n      updateImageIndex(e.screenX);\n    }\n  };\n\n  const handleMouseDown = e => {\n    e.persist();\n    setDragging(true);\n    setDragStart(e.screenX);\n    setDragStartIndex(imageIndex);\n  };\n\n  const handleMouseUp = () => {\n    setDragging(false); // false\n  };\n\n  const updateImageIndex = currentPosition => {\n    const pixelsPerImage = pixelsPerDegree * (360 / numImages);\n    let dx = (currentPosition - dragStart) / pixelsPerImage;\n    let index = Math.floor(dx) % numImages;\n\n    if (index < 0) {\n      index = numImages + index - 1;\n    }\n\n    index = (index + dragStartIndex) % numImages;\n\n    if (index !== imageIndex) {\n      setImageIndex(index);\n    }\n  };\n\n  const preventDragHandler = e => {\n    e.preventDefault();\n  };\n\n  const handlePreloadImages = async () => {\n    for (let i = 0; i <= numImages - 1; i++) {\n      const imageIndex = i;\n      const filePath = `${dir}/${imageIndex}.jpg`;\n      images.push(filePath);\n    }\n\n    const imagesLoaded = await PreloadImages(images).then(() => {\n      setImagesPreloaded(true);\n    });\n    console.log(\"imagesLoaded : \");\n  };\n\n  useEffect(() => {\n    handlePreloadImages();\n    document.addEventListener(\"mousemove\", handleMouseMove, false);\n    document.addEventListener(\"mouseup\", handleMouseUp, false); // returned function will be called on component unmount \n\n    return () => {\n      console.log(\"se desmonta\");\n      document.removeEventListener('mousemove', handleMouseMove, false);\n      document.removeEventListener(\"mouseup\", handleMouseUp, false);\n    };\n  }, []);\n\n  const renderImage = () => {\n    return __jsx(\"div\", {\n      style: {\n        position: 'absolute',\n        width: 'auto',\n        display: 'block',\n        margin: '0 auto',\n        'text-align': 'left'\n      },\n      className: \"react360\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 7\n      }\n    }, __jsx(\"img\", {\n      style: {\n        margin: 'auto',\n        position: 'relative',\n        height: '95vh',\n        width: 'auto',\n        display: 'flex',\n        'justify-content': 'center',\n        'align-items': 'center',\n        'background-color': 'white',\n        '-webkit-user-select': 'none',\n        '-khtml-user-select': 'none',\n        '-moz-user-select': 'none',\n        '-ms-user-select': 'none',\n        '-o-user-select': 'none',\n        'user-select': 'none',\n        left: '82%',\n        bottom: '150%',\n        top: '-25%',\n        'transform': 'translate(-50%, 0)',\n        '-ms-transform': 'translate(-50%, 0)',\n        '-webkit-transform': 'translate(-50%, 0)',\n        'z-index': 0\n      },\n      className: \"react-360-img\",\n      src: `${dir}/${imageIndex}.jpg`\n      /*  src={require(`${dir}/${imageIndex}.jpg`)} */\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }\n    }));\n  };\n\n  return __jsx(\"div\", {\n    className: \"react-360-img\",\n    onMouseDown: handleMouseDown,\n    onDragStart: preventDragHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    style: {\n      position: 'fixed'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }\n  }, \"Metrics:\", __jsx(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }\n  }, __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 11\n    }\n  }, \"Num images: \", numImages), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, \"Image index: \", imageIndex), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 11\n    }\n  }, \"Dragging:\", dragging ? 'Is dragging' : 'No draggin'), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 11\n    }\n  }, \"DragStart:\", dragStart), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 11\n    }\n  }, \"imagesPreloaded:\", imagesPreloaded), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 11\n    }\n  }, \"DragStartIndex: \", dragStartIndex))), renderImage());\n};\n\nexport default App;","map":{"version":3,"sources":["/home/jcastillo-vnz/orbital-react/pages/components/View360/index.tsx"],"names":["React","useState","useEffect","PreloadImages","pixelsPerDegree","App","props","dir","numImages","images","setImages","Array","imageIndex","setImageIndex","imagesPreloaded","setImagesPreloaded","dragging","setDragging","dragStartIndex","setDragStartIndex","dragStart","setDragStart","handleMouseMove","e","updateImageIndex","screenX","handleMouseDown","persist","handleMouseUp","currentPosition","pixelsPerImage","dx","index","Math","floor","preventDragHandler","preventDefault","handlePreloadImages","i","filePath","push","imagesLoaded","then","console","log","document","addEventListener","removeEventListener","renderImage","position","width","display","margin","height","left","bottom","top"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport PreloadImages from './Preload'\n\n// You can play with this to adjust the sensitivity\n// higher values make mouse less sensitive\nconst pixelsPerDegree = 2;\ninterface props {\n  dir: string\n  numImages?: number\n}\n\n\nconst App = (props: props) => {\n  const { dir, numImages } = props;\n\n  const [images, setImages] = useState(Array);\n  const [imageIndex, setImageIndex] = useState(0);\n  const [imagesPreloaded, setImagesPreloaded] = useState(false);\n  const [dragging, setDragging] = useState(false);\n  const [dragStartIndex, setDragStartIndex] = useState(0);\n  const [dragStart, setDragStart] = useState(0);\n\n  const handleMouseMove = (e) => {\n    if (dragging === false) {\n      updateImageIndex(e.screenX);\n    }\n  };\n\n  const handleMouseDown = (e) => {\n    e.persist();\n    setDragging(true)\n    setDragStart(e.screenX)\n    setDragStartIndex(imageIndex)\n  };\n\n  const handleMouseUp = () => {\n    setDragging(false)  // false\n  };\n\n  const updateImageIndex = (currentPosition) => {\n    const pixelsPerImage = pixelsPerDegree * (360 / numImages);\n    let dx = (currentPosition - dragStart) / pixelsPerImage;\n    let index = Math.floor(dx) % numImages;\n\n    if (index < 0) {\n      index = numImages + index - 1;\n    }\n    index = (index + dragStartIndex) % numImages;\n    if (index !== imageIndex) {\n      setImageIndex(index)\n    }\n  };\n\n  const preventDragHandler = e => {\n    e.preventDefault();\n  };\n\n  const handlePreloadImages = async () => {\n    for(let i=0; i <= numImages -1; i++){\n      const imageIndex = i\n      const filePath = `${dir}/${imageIndex}.jpg`\n      images.push(filePath)\n  }\n  const imagesLoaded = await  PreloadImages(images).then(() => {\n      setImagesPreloaded(true)\n    });\n    console.log(\"imagesLoaded : \")\n  }\n\n  useEffect(() => {\n    handlePreloadImages();\n    document.addEventListener(\"mousemove\", handleMouseMove, false);\n    document.addEventListener(\"mouseup\", handleMouseUp, false);\n    // returned function will be called on component unmount \n    return () => {\n      console.log(\"se desmonta\")\n      document.removeEventListener('mousemove', handleMouseMove, false);\n      document.removeEventListener(\"mouseup\", handleMouseUp, false);\n    }\n  }, []);\n\n  const renderImage = () => {\n\n    return (\n      <div style={{\n        position: 'absolute',\n        width: 'auto',\n        display: 'block',\n        margin: '0 auto',\n        'text-align': 'left',\n      } as React.CSSProperties} className=\"react360\">\n        <img style={{\n          margin: 'auto',\n          position: 'relative',\n          height: '95vh',\n          width: 'auto',\n          display: 'flex',\n          'justify-content': 'center',\n          'align-items': 'center',\n          'background-color': 'white',\n          '-webkit-user-select': 'none',\n          '-khtml-user-select': 'none',\n          '-moz-user-select': 'none',\n          '-ms-user-select': 'none',\n          '-o-user-select': 'none',\n          'user-select': 'none',\n          left: '82%',\n          bottom: '150%',\n          top: '-25%',\n          'transform': 'translate(-50%, 0)',\n          '-ms-transform': 'translate(-50%, 0)',\n          '-webkit-transform': 'translate(-50%, 0)',\n          'z-index': 0\n        } as React.CSSProperties}\n          className=\"react-360-img\"\n          src={`${dir}/${imageIndex}.jpg`}\n        /*  src={require(`${dir}/${imageIndex}.jpg`)} */\n        />\n\n      </div>\n    );\n  };\n\n\n  return (\n    <div\n      className=\"react-360-img\"\n      onMouseDown={handleMouseDown}\n      onDragStart={preventDragHandler}\n\n    >\n      <div style={{ position: 'fixed' }}>\n        Metrics:\n        <ul>\n          <li>\n            Num images: {numImages}\n          </li>\n          <li>\n            Image index: {imageIndex}\n          </li>\n          <li>\n            Dragging:{dragging ? 'Is dragging' : 'No draggin'}\n          </li>\n          <li>\n            DragStart:{dragStart}\n          </li>\n          <li>\n            imagesPreloaded:{imagesPreloaded}\n          </li>\n          <li>\n            DragStartIndex: {dragStartIndex}\n          </li>\n        </ul>\n      </div>\n      {renderImage()}\n    </div>\n  );\n\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}