{"ast":null,"code":"var _jsxFileName = \"/home/jcastillo-vnz/orbital-react/pages/components/View360/index.tsx\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport PreloadImages from './Preload'; // You can play with this to adjust the sensitivity\n// higher values make mouse less sensitive\n\nconst pixelsPerDegree = 3;\n\nconst App = props => {\n  const {\n    dir,\n    numImages\n  } = props;\n  console.log(\"dir: \", dir);\n  console.log(\"\");\n  const {\n    0: images,\n    1: setImages\n  } = useState(Array);\n  const {\n    0: imageIndex,\n    1: setImageIndex\n  } = useState(0);\n  const {\n    0: imagesPreloaded,\n    1: setImagesPreloaded\n  } = useState(false);\n  const {\n    0: dragging,\n    1: setDragging\n  } = useState(false);\n  const {\n    0: dragStartIndex,\n    1: setDragStartIndex\n  } = useState(0);\n  const {\n    0: dragStart,\n    1: setDragStart\n  } = useState(0);\n\n  const handleMouseMove = e => {\n    if (dragging === false) {\n      updateImageIndex(e.screenX);\n      console.log(\"image index\", imageIndex);\n    }\n  };\n\n  const handleMouseDown = e => {\n    e.persist();\n    setDragging(true);\n    setDragStart(e.screenX);\n    setDragStartIndex(imageIndex);\n    console.log(\"draggin set in true --->\", dragging);\n  };\n\n  const handleMouseUp = () => {\n    setDragging(false); // false\n  };\n\n  const updateImageIndex = currentPosition => {\n    console.log(\"updateImageIndex\", currentPosition);\n    const pixelsPerImage = pixelsPerDegree * (360 / numImages);\n    let dx = (currentPosition - dragStart) / pixelsPerImage;\n    let index = Math.floor(dx) % numImages;\n\n    if (index < 0) {\n      index = numImages + index - 1;\n    }\n\n    index = (index + dragStartIndex) % numImages;\n\n    if (index !== imageIndex) {\n      setImageIndex(index);\n    }\n  };\n\n  const preventDragHandler = e => {\n    e.preventDefault();\n  };\n\n  const handlePreloadImages = async () => {\n    await PreloadImages(images).then(() => {\n      setImagesPreloaded(true);\n    });\n    console.log(\"manejador de preloaded\");\n  };\n\n  useEffect(() => {\n    handlePreloadImages();\n    document.addEventListener(\"mousemove\", handleMouseMove, false);\n    document.addEventListener(\"mouseup\", handleMouseUp, false); // returned function will be called on component unmount \n\n    return () => {\n      console.log(\"se desmonta\");\n      document.removeEventListener('mousemove', handleMouseMove, false);\n      document.removeEventListener(\"mouseup\", handleMouseUp, false);\n    };\n  }, []);\n\n  const renderImage = () => {\n    return __jsx(\"div\", {\n      style: {\n        position: 'absolute',\n        width: 'auto',\n        display: 'block',\n        margin: '0 auto',\n        'text-align': 'left'\n      },\n      className: \"react360\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 7\n      }\n    }, __jsx(\"img\", {\n      style: {\n        margin: 'auto',\n        position: 'relative',\n        height: '95vh',\n        width: 'auto',\n        display: 'flex',\n        'justify-content': 'center',\n        'align-items': 'center',\n        'background-color': 'white',\n        '-webkit-user-select': 'none',\n        '-khtml-user-select': 'none',\n        '-moz-user-select': 'none',\n        '-ms-user-select': 'none',\n        '-o-user-select': 'none',\n        'user-select': 'none',\n        left: '82%',\n        bottom: '150%',\n        top: '-25%',\n        'transform': 'translate(-50%, 0)',\n        '-ms-transform': 'translate(-50%, 0)',\n        '-webkit-transform': 'translate(-50%, 0)',\n        'z-index': 0\n      },\n      className: \"react-360-img\",\n      src: `${dir}/${imageIndex}.jpg`\n      /*  src={require(`${dir}/${imageIndex}.jpg`)} */\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }\n    }));\n  };\n\n  return __jsx(\"div\", {\n    className: \"react-360-img\",\n    onMouseDown: handleMouseDown,\n    onDragStart: preventDragHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    style: {\n      position: 'fixed'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 7\n    }\n  }, \"Metrics:\", __jsx(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  }, __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 11\n    }\n  }, \"Num images: \", numImages), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 11\n    }\n  }, \"Image index: \", imageIndex), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 11\n    }\n  }, \"Dragging:\", dragging ? 'Is dragging' : 'No draggin'), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 11\n    }\n  }, \"DragStart:\", dragStart), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 11\n    }\n  }, \"imagesPreloaded:\", imagesPreloaded), __jsx(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 11\n    }\n  }, \"DragStartIndex: \", dragStartIndex))), renderImage());\n};\n\nexport default App;","map":{"version":3,"sources":["/home/jcastillo-vnz/orbital-react/pages/components/View360/index.tsx"],"names":["React","useState","useEffect","PreloadImages","pixelsPerDegree","App","props","dir","numImages","console","log","images","setImages","Array","imageIndex","setImageIndex","imagesPreloaded","setImagesPreloaded","dragging","setDragging","dragStartIndex","setDragStartIndex","dragStart","setDragStart","handleMouseMove","e","updateImageIndex","screenX","handleMouseDown","persist","handleMouseUp","currentPosition","pixelsPerImage","dx","index","Math","floor","preventDragHandler","preventDefault","handlePreloadImages","then","document","addEventListener","removeEventListener","renderImage","position","width","display","margin","height","left","bottom","top"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport PreloadImages from './Preload'\n\n// You can play with this to adjust the sensitivity\n// higher values make mouse less sensitive\nconst pixelsPerDegree = 3;\n\ninterface props {\n  dir: string\n  numImages?: number\n}\n\n\nconst App = (props: props) => {\n  const { dir, numImages } = props;\n  console.log(\"dir: \", dir)\n  console.log(\"\")\n  const [images, setImages] = useState(Array);\n  const [imageIndex, setImageIndex] = useState(0);\n  const [imagesPreloaded, setImagesPreloaded] = useState(false);\n  const [dragging, setDragging] = useState(false);\n  const [dragStartIndex, setDragStartIndex] = useState(0);\n  const [dragStart, setDragStart] = useState(0);\n\n  const handleMouseMove = (e) => {\n    if (dragging === false) {\n      updateImageIndex(e.screenX);\n      console.log(\"image index\", imageIndex)\n    }\n  };\n\n  const handleMouseDown = (e) => {\n    e.persist();\n    setDragging(true)\n    setDragStart(e.screenX)\n    setDragStartIndex(imageIndex)\n    console.log(\"draggin set in true --->\", dragging)\n  };\n\n  const handleMouseUp = () => {\n    setDragging(false)  // false\n  };\n\n  const updateImageIndex = (currentPosition) => {\n    console.log(\"updateImageIndex\", currentPosition)\n    const pixelsPerImage = pixelsPerDegree * (360 / numImages);\n    let dx = (currentPosition - dragStart) / pixelsPerImage;\n    let index = Math.floor(dx) % numImages;\n\n    if (index < 0) {\n      index = numImages + index - 1;\n    }\n    index = (index + dragStartIndex) % numImages;\n    if (index !== imageIndex) {\n      setImageIndex(index)\n    }\n  };\n\n  const preventDragHandler = e => {\n    e.preventDefault();\n  };\n\n  const handlePreloadImages = async () => {\n  await  PreloadImages(images).then(() => {\n      setImagesPreloaded(true)\n    });\n    console.log(\"manejador de preloaded\")\n  }\n\n  useEffect(() => {\n    handlePreloadImages();\n    document.addEventListener(\"mousemove\", handleMouseMove, false);\n    document.addEventListener(\"mouseup\", handleMouseUp, false);\n    // returned function will be called on component unmount \n    return () => {\n      console.log(\"se desmonta\")\n      document.removeEventListener('mousemove', handleMouseMove, false);\n      document.removeEventListener(\"mouseup\", handleMouseUp, false);\n    }\n  }, []);\n\n\n\n\n  const renderImage = () => {\n\n    return (\n      <div style={{\n        position: 'absolute',\n        width: 'auto',\n        display: 'block',\n        margin: '0 auto',\n        'text-align': 'left',\n      } as React.CSSProperties} className=\"react360\">\n        <img style={{\n          margin: 'auto',\n          position: 'relative',\n          height: '95vh',\n          width: 'auto',\n          display: 'flex',\n          'justify-content': 'center',\n          'align-items': 'center',\n          'background-color': 'white',\n          '-webkit-user-select': 'none',\n          '-khtml-user-select': 'none',\n          '-moz-user-select': 'none',\n          '-ms-user-select': 'none',\n          '-o-user-select': 'none',\n          'user-select': 'none',\n          left: '82%',\n          bottom: '150%',\n          top: '-25%',\n          'transform': 'translate(-50%, 0)',\n          '-ms-transform': 'translate(-50%, 0)',\n          '-webkit-transform': 'translate(-50%, 0)',\n          'z-index': 0\n        } as React.CSSProperties}\n          className=\"react-360-img\"\n          src={`${dir}/${imageIndex}.jpg`}\n        /*  src={require(`${dir}/${imageIndex}.jpg`)} */\n        />\n\n      </div>\n    );\n  };\n\n\n  return (\n    <div\n      className=\"react-360-img\"\n      onMouseDown={handleMouseDown}\n      onDragStart={preventDragHandler}\n\n    >\n      <div style={{ position: 'fixed' }}>\n        Metrics:\n        <ul>\n          <li>\n            Num images: {numImages}\n          </li>\n          <li>\n            Image index: {imageIndex}\n          </li>\n          <li>\n            Dragging:{dragging ? 'Is dragging' : 'No draggin'}\n          </li>\n          <li>\n            DragStart:{dragStart}\n          </li>\n          <li>\n            imagesPreloaded:{imagesPreloaded}\n          </li>\n          <li>\n            DragStartIndex: {dragStartIndex}\n          </li>\n        </ul>\n      </div>\n      {renderImage()}\n    </div>\n  );\n\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}